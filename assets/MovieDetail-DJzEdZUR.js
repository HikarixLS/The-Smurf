import{u as ee,j as e,L as se}from"./index-DvuVciiU.js";import{h as ae,e as te,b as n}from"./vendor-DTekaQTv.js";import{j as le,k as ie,l as ne,m as ce,F as G,n as oe,o as re,p as de,q as R}from"./index-CWt2mSl_.js";import{H as y}from"./Header-BT5vLLWG.js";import{F as P,g as M,s as he}from"./helpers-D2sZRfs5.js";import{M as me}from"./MovieRow-D6duPf6b.js";import{m as h}from"./movieService-C55wwl9l.js";import{i as _e,a as ge,r as je,b as we,c as pe,d as ue}from"./watchlistService-DAgocvRz.js";import"./firebase-B8FQZRyY.js";import"./MovieCard-D7_LZJao.js";import"./index-BDRdhlOT.js";import"./endpoints-B3ywRY_-.js";const xe="_movieDetail_wdjbw_1",be="_errorPage_wdjbw_7",ve="_homeBtn_wdjbw_22",Ne="_hero_wdjbw_39",ye="_heroImage_wdjbw_46",fe="_heroOverlay_wdjbw_55",Ie="_heroContent_wdjbw_64",Be="_posterWrapper_wdjbw_76",ke="_poster_wdjbw_76",Se="_heroInfo_wdjbw_88",Te="_title_wdjbw_93",Ce="_originName_wdjbw_101",Fe="_metaRow_wdjbw_109",Le="_ratingBadge_wdjbw_117",$e="_metaBadge_wdjbw_130",Ge="_qualityBadge_wdjbw_142",Re="_langBadge_wdjbw_152",Pe="_genres_wdjbw_163",Me="_genreTag_wdjbw_170",Ae="_actions_wdjbw_187",De="_watchBtn_wdjbw_194",qe="_actionBtn_wdjbw_215",He="_active_wdjbw_239",Oe="_tabSection_wdjbw_246",We="_tabs_wdjbw_252",Ve="_tab_wdjbw_246",Ke="_tabActive_wdjbw_276",Ee="_tabContent_wdjbw_282",ze="_overview_wdjbw_299",Ue="_description_wdjbw_305",Qe="_detailGrid_wdjbw_312",Xe="_detailItem_wdjbw_318",Ye="_detailLabel_wdjbw_328",Je="_episodeGrid_wdjbw_341",Ze="_episodeBtn_wdjbw_347",es="_castGrid_wdjbw_369",ss="_castItem_wdjbw_375",as="_castAvatar_wdjbw_385",ts="_castName_wdjbw_399",ls="_castPhoto_wdjbw_404",is="_castInfo_wdjbw_413",ns="_castRole_wdjbw_420",cs="_keywords_wdjbw_429",os="_keywordsIcon_wdjbw_437",rs="_keywordTag_wdjbw_443",ds="_gallerySection_wdjbw_453",hs="_galleryTitle_wdjbw_457",ms="_galleryGrid_wdjbw_466",_s="_posterGrid_wdjbw_473",gs="_galleryItem_wdjbw_480",js="_lightbox_wdjbw_502",ws="_lightboxClose_wdjbw_522",ps="_empty_wdjbw_544",us="_scheduleSection_wdjbw_699",xs="_scheduleTitle_wdjbw_703",bs="_scheduleCard_wdjbw_709",vs="_scheduleInfo_wdjbw_716",Ns="_scheduleRow_wdjbw_722",ys="_scheduleLabel_wdjbw_728",fs="_scheduleValue_wdjbw_733",Is="_statusOngoing_wdjbw_739",Bs="_progressBarSchedule_wdjbw_743",ks="_progressFill_wdjbw_751",s={movieDetail:xe,errorPage:be,homeBtn:ve,hero:Ne,heroImage:ye,heroOverlay:fe,heroContent:Ie,posterWrapper:Be,poster:ke,heroInfo:Se,title:Te,originName:Ce,metaRow:Fe,ratingBadge:Le,metaBadge:$e,qualityBadge:Ge,langBadge:Re,genres:Pe,genreTag:Me,actions:Ae,watchBtn:De,actionBtn:qe,active:He,tabSection:Oe,tabs:We,tab:Ve,tabActive:Ke,tabContent:Ee,overview:ze,description:Ue,detailGrid:Qe,detailItem:Xe,detailLabel:Ye,episodeGrid:Je,episodeBtn:Ze,castGrid:es,castItem:ss,castAvatar:as,castName:ts,castPhoto:ls,castInfo:is,castRole:ns,keywords:cs,keywordsIcon:os,keywordTag:rs,gallerySection:ds,galleryTitle:hs,galleryGrid:ms,posterGrid:_s,galleryItem:gs,lightbox:js,lightboxClose:ws,empty:ps,scheduleSection:us,scheduleTitle:xs,scheduleCard:bs,scheduleInfo:vs,scheduleRow:Ns,scheduleLabel:ys,scheduleValue:fs,statusOngoing:Is,progressBarSchedule:Bs,progressFill:ks},m="https://image.tmdb.org/t/p",qs=()=>{const{slug:i}=ae(),_=te(),{user:c}=ee(),[a,A]=n.useState(null),[D,f]=n.useState(!0),[I,g]=n.useState(null),[r,q]=n.useState("overview"),[B,H]=n.useState([]),[j,k]=n.useState(!1),[w,S]=n.useState(!1),[o,O]=n.useState(null),[p,W]=n.useState(null),[T,V]=n.useState(null),[C,u]=n.useState(null);n.useEffect(()=>{z()},[i]),n.useEffect(()=>{if(!c||!i)return;(async()=>{const[l,d]=await Promise.all([_e(c.uid,i),ge(c.uid,i)]);k(l),S(d)})()},[c,i]);const K=async()=>{!c||!a||(j?await je(c.uid,i):await we(c.uid,a),k(!j))},E=async()=>{!c||!a||(w?await pe(c.uid,i):await ue(c.uid,a),S(!w))},z=async()=>{f(!0),g(null);try{const t=await h.getMovieDetail(i);if(t?.data?.item){A(t.data.item);const[l,d,v,N]=await Promise.allSettled([t.data.item.category?.length>0?h.getMoviesByCategory(t.data.item.category[0].slug,1):Promise.resolve(null),h.getMovieImages(i),h.getMoviePeoples(i),h.getMovieKeywords(i)]);l.status==="fulfilled"&&l.value?.data?.items&&H(l.value.data.items.filter(Z=>Z.slug!==i)),d.status==="fulfilled"&&d.value?.data?.images&&O(d.value.data.images),v.status==="fulfilled"&&v.value?.data&&W(v.value.data),N.status==="fulfilled"&&N.value?.data?.keywords&&V(N.value.data.keywords)}else g("Kh√¥ng t√¨m th·∫•y phim")}catch{g("L·ªói t·∫£i th√¥ng tin phim")}finally{f(!1)}},U=()=>_(`/watch/${i}`),Q=()=>{navigator.share?navigator.share({title:a.name,url:window.location.href}):navigator.clipboard.writeText(window.location.href)};if(D)return e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(se,{})})]});if(I||!a)return e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsxs("div",{className:s.errorPage,children:[e.jsx("h1",{children:I||"Kh√¥ng t√¨m th·∫•y phim"}),e.jsx("button",{className:s.homeBtn,onClick:()=>_("/"),children:"V·ªÅ trang ch·ªß"})]}),e.jsx(P,{})]});const X=M(a.poster_url||a.thumb_url),Y=M(a.thumb_url||a.poster_url),F=a.tmdb?.vote_average||0,L=a.episodes?.[0]?.server_data||[],x=["overview","episodes","cast"];(o?.backdrops?.length>0||o?.posters?.length>0)&&x.push("gallery"),x.push("related");const J={overview:"T·ªïng quan",episodes:"T·∫≠p phim",cast:"Di·ªÖn vi√™n",gallery:"H√¨nh ·∫£nh",related:"ƒê·ªÅ xu·∫•t"},$=p?.cast?.length>0?p.cast.slice(0,20):a.actor?.map(t=>({name:t,profile_path:null}))||[],b=p?.crew?.filter(t=>t.job==="Director")||[];return e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsxs("main",{className:s.movieDetail,children:[e.jsxs("div",{className:s.hero,children:[e.jsx("img",{src:X,alt:"",className:s.heroImage}),e.jsx("div",{className:s.heroOverlay}),e.jsxs("div",{className:s.heroContent,children:[e.jsx("div",{className:s.posterWrapper,children:e.jsx("img",{src:Y,alt:a.name,className:s.poster})}),e.jsxs("div",{className:s.heroInfo,children:[e.jsx("h1",{className:s.title,children:a.origin_name||a.name}),a.origin_name&&a.name!==a.origin_name&&e.jsx("p",{className:s.originName,children:a.name}),e.jsxs("div",{className:s.metaRow,children:[F>0&&e.jsxs("span",{className:s.ratingBadge,children:[e.jsx(le,{})," ",F.toFixed(1)]}),a.year&&e.jsxs("span",{className:s.metaBadge,children:[e.jsx(ie,{})," ",a.year]}),a.time&&e.jsxs("span",{className:s.metaBadge,children:[e.jsx(ne,{})," ",a.time]}),a.quality&&e.jsx("span",{className:s.qualityBadge,children:a.quality}),a.lang&&e.jsx("span",{className:s.langBadge,children:a.lang}),a.episode_current&&e.jsx("span",{className:s.metaBadge,children:a.episode_current})]}),a.category?.length>0&&e.jsx("div",{className:s.genres,children:a.category.map((t,l)=>e.jsx("span",{className:s.genreTag,children:t.name},l))}),T?.length>0&&e.jsxs("div",{className:s.keywords,children:[e.jsx(ce,{className:s.keywordsIcon}),T.slice(0,6).map((t,l)=>e.jsx("span",{className:s.keywordTag,children:t.name_vn||t.name},l))]}),e.jsxs("div",{className:s.actions,children:[e.jsxs("button",{className:s.watchBtn,onClick:U,children:[e.jsx(G,{})," Xem Ngay"]}),e.jsxs("button",{className:`${s.actionBtn} ${j?s.active:""}`,onClick:K,children:[e.jsx(oe,{}),e.jsx("span",{children:"Y√™u th√≠ch"})]}),e.jsxs("button",{className:`${s.actionBtn} ${w?s.active:""}`,onClick:E,children:[e.jsx(re,{}),e.jsx("span",{children:"L∆∞u l·∫°i"})]}),e.jsxs("button",{className:s.actionBtn,onClick:Q,children:[e.jsx(de,{}),e.jsx("span",{children:"Chia s·∫ª"})]})]})]})]})]}),e.jsxs("div",{className:s.tabSection,children:[e.jsx("div",{className:s.tabs,children:x.map(t=>e.jsx("button",{className:`${s.tab} ${r===t?s.tabActive:""}`,onClick:()=>q(t),children:J[t]},t))}),e.jsxs("div",{className:s.tabContent,children:[r==="overview"&&e.jsxs("div",{className:s.overview,children:[e.jsx("h3",{children:"N·ªôi dung"}),e.jsx("p",{className:s.description,children:a.content?he(a.content):"ƒêang c·∫≠p nh·∫≠t..."}),e.jsxs("div",{className:s.detailGrid,children:[a.country?.length>0&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Qu·ªëc gia"}),e.jsx("span",{children:a.country.map(t=>t.name).join(", ")})]}),(b.length>0||a.director?.length>0)&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"ƒê·∫°o di·ªÖn"}),e.jsx("span",{children:b.length>0?b.map(t=>t.name).join(", "):a.director.join(", ")})]}),a.status&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Tr·∫°ng th√°i"}),e.jsx("span",{children:a.status==="completed"?"Ho√†n th√†nh":"ƒêang c·∫≠p nh·∫≠t"})]}),a.episode_total&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"S·ªë t·∫≠p"}),e.jsxs("span",{children:[a.episode_current," / ",a.episode_total]})]})]}),a.type==="series"&&a.status!=="completed"&&e.jsxs("div",{className:s.scheduleSection,children:[e.jsx("h3",{className:s.scheduleTitle,children:"üìÖ L·ªãch chi·∫øu"}),e.jsx("div",{className:s.scheduleCard,children:e.jsxs("div",{className:s.scheduleInfo,children:[e.jsxs("div",{className:s.scheduleRow,children:[e.jsx("span",{className:s.scheduleLabel,children:"Ti·∫øn ƒë·ªô"}),e.jsxs("span",{className:s.scheduleValue,children:[a.episode_current||"?"," / ",a.episode_total||"?"," t·∫≠p"]})]}),e.jsx("div",{className:s.progressBarSchedule,children:e.jsx("div",{className:s.progressFill,style:{width:a.episode_total?`${parseInt(a.episode_current)/parseInt(a.episode_total)*100}%`:"0%"}})}),e.jsxs("div",{className:s.scheduleRow,children:[e.jsx("span",{className:s.scheduleLabel,children:"Tr·∫°ng th√°i"}),e.jsx("span",{className:`${s.scheduleValue} ${s.statusOngoing}`,children:"üî¥ ƒêang ph√°t s√≥ng"})]}),e.jsxs("div",{className:s.scheduleRow,children:[e.jsx("span",{className:s.scheduleLabel,children:"C·∫≠p nh·∫≠t"}),e.jsx("span",{className:s.scheduleValue,children:"H√†ng tu·∫ßn"})]})]})})]})]}),r==="episodes"&&e.jsx("div",{className:s.episodesList,children:L.length>0?e.jsx("div",{className:s.episodeGrid,children:L.map((t,l)=>e.jsxs("button",{className:s.episodeBtn,onClick:()=>_(`/watch/${i}`),children:[e.jsx(G,{size:14}),e.jsx("span",{children:t.name})]},l))}):e.jsx("p",{className:s.empty,children:"Ch∆∞a c√≥ t·∫≠p phim"})}),r==="cast"&&e.jsx("div",{className:s.castList,children:$.length>0?e.jsx("div",{className:s.castGrid,children:$.map((t,l)=>e.jsxs("div",{className:s.castItem,children:[t.profile_path?e.jsx("img",{src:`${m}/w185${t.profile_path}`,alt:t.name,className:s.castPhoto}):e.jsx("div",{className:s.castAvatar,children:(t.name||"?").charAt(0)}),e.jsxs("div",{className:s.castInfo,children:[e.jsx("span",{className:s.castName,children:t.name}),t.character&&e.jsx("span",{className:s.castRole,children:t.character})]})]},l))}):e.jsx("p",{className:s.empty,children:"ƒêang c·∫≠p nh·∫≠t..."})}),r==="gallery"&&e.jsxs("div",{className:s.gallerySection,children:[o?.backdrops?.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:s.galleryTitle,children:[e.jsx(R,{})," ·∫¢nh n·ªÅn (",o.backdrops.length,")"]}),e.jsx("div",{className:s.galleryGrid,children:o.backdrops.slice(0,12).map((t,l)=>e.jsx("div",{className:s.galleryItem,onClick:()=>u(`${m}/original${t.file_path}`),children:e.jsx("img",{src:`${m}/w500${t.file_path}`,alt:`Backdrop ${l+1}`,loading:"lazy"})},l))})]}),o?.posters?.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:s.galleryTitle,children:[e.jsx(R,{})," Poster (",o.posters.length,")"]}),e.jsx("div",{className:s.posterGrid,children:o.posters.slice(0,8).map((t,l)=>e.jsx("div",{className:s.galleryItem,onClick:()=>u(`${m}/original${t.file_path}`),children:e.jsx("img",{src:`${m}/w342${t.file_path}`,alt:`Poster ${l+1}`,loading:"lazy"})},l))})]}),C&&e.jsxs("div",{className:s.lightbox,onClick:()=>u(null),children:[e.jsx("img",{src:C,alt:"Full size"}),e.jsx("button",{className:s.lightboxClose,children:"‚úï"})]})]}),r==="related"&&e.jsx("div",{className:s.relatedSection,children:B.length>0?e.jsx(me,{title:"Phim t∆∞∆°ng t·ª±",movies:B}):e.jsx("p",{className:s.empty,children:"Kh√¥ng c√≥ phim li√™n quan"})})]})]})]}),e.jsx(P,{})]})};export{qs as default};
