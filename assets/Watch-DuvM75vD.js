import{j as e,L as B}from"./index-CgVwppYc.js";import{f as P,u as k,b as r}from"./vendor-DbVhFtnB.js";import{H as g,m as b,n as C,o as A,p as F}from"./Header-BXtNmw57.js";import{F as M}from"./Footer-Cmz1iNZx.js";import{M as E}from"./MovieRow-D9jeAXmo.js";import{m as u}from"./movieService-DXq-Rl6U.js";import"./MovieCard-hqABC4nK.js";import"./index-CO4GaNJo.js";import"./endpoints-DekhD34g.js";const L="_watch_e39pj_1",q="_loadingPage_e39pj_7",V="_errorPage_e39pj_15",D="_container_e39pj_34",W="_topBar_e39pj_41",$="_backBtn_e39pj_48",G="_nowPlaying_e39pj_68",I="_movieName_e39pj_75",R="_episodeName_e39pj_84",H="_playerSection_e39pj_91",K="_playerWrapper_e39pj_95",z="_player_e39pj_91",Q="_noVideo_e39pj_113",U="_serverSection_e39pj_126",J="_sectionTitle_e39pj_130",O="_serverList_e39pj_137",X="_serverBtn_e39pj_144",Y="_serverActive_e39pj_160",Z="_episodeSection_e39pj_167",ee="_episodeToggle_e39pj_171",se="_episodeGrid_e39pj_184",te="_episodeBtn_e39pj_191",ae="_episodeActive_e39pj_208",ie="_movieInfo_e39pj_216",re="_movieTitle_e39pj_221",oe="_meta_e39pj_228",ne="_qualityTag_e39pj_237",ce="_langTag_e39pj_246",le="_relatedSection_e39pj_256",s={watch:L,loadingPage:q,errorPage:V,container:D,topBar:W,backBtn:$,nowPlaying:G,movieName:I,episodeName:R,playerSection:H,playerWrapper:K,player:z,noVideo:Q,serverSection:U,sectionTitle:J,serverList:O,serverBtn:X,serverActive:Y,episodeSection:Z,episodeToggle:ee,episodeGrid:se,episodeBtn:te,episodeActive:ae,movieInfo:ie,movieTitle:re,meta:oe,qualityTag:ne,langTag:ce,relatedSection:le},xe=()=>{const{slug:n}=P(),d=k(),[t,x]=r.useState(null),[y,m]=r.useState(!0),[_,j]=r.useState(0),[v,N]=r.useState(0),[h,S]=r.useState([]),[l,f]=r.useState(!0);r.useEffect(()=>{T()},[n]);const T=async()=>{m(!0);try{const i=await u.getMovieDetail(n);if(i?.data?.item&&(x(i.data.item),i.data.item.category?.length>0))try{const a=await u.getMoviesByCategory(i.data.item.category[0].slug,1);a?.data?.items&&S(a.data.items.filter(w=>w.slug!==n).slice(0,12))}catch{}}catch(i){console.error("Error:",i)}finally{m(!1)}};if(y)return e.jsx("div",{className:s.loadingPage,children:e.jsx(B,{})});if(!t)return e.jsxs(e.Fragment,{children:[e.jsx(g,{}),e.jsxs("div",{className:s.errorPage,children:[e.jsx("h1",{children:"Không tìm thấy phim"}),e.jsx("button",{onClick:()=>d("/"),children:"Về trang chủ"})]})]});const p=t.episodes||[],c=p[v]?.server_data||[],o=c[_];return e.jsxs(e.Fragment,{children:[e.jsx(g,{}),e.jsxs("main",{className:s.watch,children:[e.jsxs("div",{className:s.container,children:[e.jsxs("div",{className:s.topBar,children:[e.jsxs("button",{className:s.backBtn,onClick:()=>d(`/movie/${n}`),children:[e.jsx(b,{})," Quay lại"]}),e.jsxs("div",{className:s.nowPlaying,children:[e.jsx("span",{className:s.movieName,children:t.name}),o&&e.jsxs("span",{className:s.episodeName,children:["- Tập ",o.name]})]})]}),e.jsx("div",{className:s.playerSection,children:e.jsx("div",{className:s.playerWrapper,children:o?.link_embed?e.jsx("iframe",{src:o.link_embed,className:s.player,allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"}):o?.link_m3u8?e.jsx("video",{src:o.link_m3u8,className:s.player,controls:!0,autoPlay:!0}):e.jsxs("div",{className:s.noVideo,children:[e.jsx(C,{size:48}),e.jsx("p",{children:"Không có nguồn phim khả dụng"})]})})}),p.length>1&&e.jsxs("div",{className:s.serverSection,children:[e.jsx("h3",{className:s.sectionTitle,children:"Chọn server"}),e.jsx("div",{className:s.serverList,children:p.map((i,a)=>e.jsx("button",{className:`${s.serverBtn} ${a===v?s.serverActive:""}`,onClick:()=>{N(a),j(0)},children:i.server_name},a))})]}),c.length>1&&e.jsxs("div",{className:s.episodeSection,children:[e.jsxs("button",{className:s.episodeToggle,onClick:()=>f(!l),children:[e.jsxs("h3",{className:s.sectionTitle,children:["Danh sách tập (",c.length," tập)"]}),l?e.jsx(A,{}):e.jsx(F,{})]}),l&&e.jsx("div",{className:s.episodeGrid,children:c.map((i,a)=>e.jsx("button",{className:`${s.episodeBtn} ${a===_?s.episodeActive:""}`,onClick:()=>j(a),children:i.name},a))})]}),e.jsxs("div",{className:s.movieInfo,children:[e.jsx("h2",{className:s.movieTitle,children:t.name}),e.jsxs("div",{className:s.meta,children:[t.year&&e.jsx("span",{children:t.year}),t.quality&&e.jsx("span",{className:s.qualityTag,children:t.quality}),t.lang&&e.jsx("span",{className:s.langTag,children:t.lang}),t.episode_current&&e.jsx("span",{children:t.episode_current})]})]})]}),h.length>0&&e.jsx("div",{className:s.relatedSection,children:e.jsx(E,{title:"Phim đề xuất",movies:h})})]}),e.jsx(M,{})]})};export{xe as default};
