import{j as e}from"./index-TLiYB9Yu.js";import{b as n,e as B,f as q}from"./vendor-DTekaQTv.js";import{H as k}from"./Header-CLmer38b.js";import{F as w}from"./helpers-2cNXg5aS.js";import{d as M,e as $}from"./index-D5LGCugf.js";import{P as x}from"./index-BDRdhlOT.js";import{a as y,E as j}from"./endpoints-D8T1TGp9.js";import{M as F}from"./MovieGrid-DqKztugZ.js";import"./firebase-B8FQZRyY.js";import"./MovieCard-CqGbki7V.js";const b={searchMovies:async(s,a=20)=>{try{if(!s||s.trim()==="")return{data:{items:[]}};const t=new URLSearchParams({keyword:s.trim(),limit:a.toString()});return await y.get(`${j.SEARCH}?${t.toString()}`)}catch(t){throw console.error("Error searching movies:",t),t}},getSearchSuggestions:async(s,a=5)=>{try{if(!s||s.trim()===""||s.length<2)return{data:{items:[]}};const t=new URLSearchParams({keyword:s.trim(),limit:a.toString()});return await y.get(`${j.SEARCH}?${t.toString()}`)}catch(t){return console.error("Error getting search suggestions:",t),{data:{items:[]}}}}},P=(s,a=500)=>{const[t,c]=n.useState(s);return n.useEffect(()=>{const m=setTimeout(()=>{c(s)},a);return()=>{clearTimeout(m)}},[s,a]),t},L="_searchBar_1mb2a_1",A="_inputContainer_1mb2a_6",D="_searchInput_1mb2a_11",H="_searchIcon_1mb2a_35",K="_clearButton_1mb2a_44",U="_autocomplete_1mb2a_66",z="_autocompleteItem_1mb2a_82",V="_itemTitle_1mb2a_97",G="_itemMeta_1mb2a_102",O="_noResults_1mb2a_107",o={searchBar:L,inputContainer:A,searchInput:D,searchIcon:H,clearButton:K,autocomplete:U,autocompleteItem:z,itemTitle:V,itemMeta:G,noResults:O},N=({onSearch:s,autoFocus:a=!1})=>{const[t,c]=n.useState(""),[m,u]=n.useState([]),[d,i]=n.useState(!1),[S,f]=n.useState(!1),l=B(),p=n.useRef(null),g=P(t,500);n.useEffect(()=>{a&&p.current&&p.current.focus()},[a]),n.useEffect(()=>{g&&g.length>=2?I(g):(u([]),i(!1))},[g]);const I=async r=>{f(!0);try{const h=await b.getSearchSuggestions(r,5);h&&h.data&&h.data.items&&(u(h.data.items),i(!0))}catch(h){console.error("Error fetching suggestions:",h),u([])}finally{f(!1)}},v=r=>{c(r.target.value)},C=r=>{r.preventDefault(),t.trim()&&(i(!1),s?s(t):l(`/search?q=${encodeURIComponent(t)}`))},E=r=>{c(""),i(!1),l(`/movie/${r.slug}`)},R=()=>{c(""),u([]),i(!1),p.current&&p.current.focus()},T=()=>{setTimeout(()=>{i(!1)},200)};return e.jsxs("div",{className:o.searchBar,children:[e.jsx("form",{onSubmit:C,children:e.jsxs("div",{className:o.inputContainer,children:[e.jsx(M,{className:o.searchIcon,size:20}),e.jsx("input",{ref:p,type:"text",className:o.searchInput,placeholder:"Tìm kiếm phim...",value:t,onChange:v,onBlur:T,onFocus:()=>t.length>=2&&i(!0)}),t&&e.jsx("button",{type:"button",className:o.clearButton,onClick:R,children:e.jsx($,{size:16})})]})}),d&&m.length>0&&e.jsx("div",{className:o.autocomplete,children:m.map(r=>e.jsxs("div",{className:o.autocompleteItem,onClick:()=>E(r),children:[e.jsx("div",{className:o.itemTitle,children:r.name}),e.jsxs("div",{className:o.itemMeta,children:[r.year," • ",r.quality," • ",r.lang]})]},r._id||r.slug))}),d&&t.length>=2&&m.length===0&&!S&&e.jsx("div",{className:o.autocomplete,children:e.jsx("div",{className:o.noResults,children:"Không tìm thấy kết quả"})})]})};N.propTypes={onSearch:x.func,autoFocus:x.bool};const X="_search_1g8qy_1",J="_title_1g8qy_6",Q="_resultInfo_1g8qy_16",W="_emptyState_1g8qy_22",_={search:X,title:J,resultInfo:Q,emptyState:W},ie=()=>{const[s]=q(),a=s.get("q")||"",[t,c]=n.useState([]),[m,u]=n.useState(!1),[d,i]=n.useState(null);n.useEffect(()=>{a&&S(a)},[a]);const S=async f=>{u(!0),i(null);try{const l=await b.searchMovies(f,50);l&&l.data&&l.data.items?c(l.data.items):c([])}catch(l){i("Lỗi tìm kiếm, vui lòng thử lại"),console.error("Search error:",l)}finally{u(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsx("main",{className:_.search,children:e.jsxs("div",{className:"container",children:[e.jsx("h1",{className:_.title,children:"Tìm kiếm phim"}),e.jsx(N,{autoFocus:!a}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:_.resultInfo,children:m?"Đang tìm kiếm...":`Tìm thấy ${t.length} kết quả cho "${a}"`}),e.jsx(F,{movies:t,loading:m,error:d,hasMore:!1})]}),!a&&e.jsx("div",{className:_.emptyState,children:e.jsx("p",{children:"Nhập từ khóa để tìm kiếm phim"})})]})}),e.jsx(w,{})]})};export{ie as default};
