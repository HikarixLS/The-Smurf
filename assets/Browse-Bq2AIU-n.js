import{j as t}from"./index-D7_Flvb3.js";import{f as J,b as n}from"./vendor-DTekaQTv.js";import{f as K,g as V,h as w,i as S,e as Z}from"./index-CWt2mSl_.js";import{H as ee}from"./Header-Dhg1R4lm.js";import{F as te}from"./Footer-BhtKaMAj.js";import{M as se}from"./MovieGrid-O56fEhT3.js";import{m as d}from"./movieService-IRTZGQQP.js";import"./firebase-B8FQZRyY.js";import"./index-BDRdhlOT.js";import"./MovieCard-qBg1jxw8.js";import"./helpers-VdV8ob_0.js";import"./endpoints-lq1-MLVT.js";const ae="_browse_1wj5q_1",ie="_container_1wj5q_7",re="_header_1wj5q_13",ne="_title_1wj5q_20",le="_headerActions_1wj5q_27",oe="_sortWrapper_1wj5q_33",ce="_sortIcon_1wj5q_39",me="_sortSelect_1wj5q_47",ue="_filterToggle_1wj5q_70",he="_filterLoading_1wj5q_89",fe="_filtersPanel_1wj5q_96",de="_filterGroup_1wj5q_117",pe="_filterLabel_1wj5q_125",ge="_activeIndicator_1wj5q_147",je="_filterOptions_1wj5q_153",_e="_filterChip_1wj5q_159",ve="_chipActive_1wj5q_175",xe="_clearBtn_1wj5q_182",s={browse:ae,container:ie,header:re,title:ne,headerActions:le,sortWrapper:oe,sortIcon:ce,sortSelect:me,filterToggle:ue,filterLoading:he,filtersPanel:fe,filterGroup:de,filterLabel:pe,activeIndicator:ge,filterOptions:je,filterChip:_e,chipActive:ve,clearBtn:xe},Ne=[{name:"Tất cả",value:""},{name:"Phim lẻ",value:"single"},{name:"Phim bộ",value:"series"},{name:"Phim chiếu rạp",value:"hoathinh"}],ye=[{name:"Mới cập nhật",value:"modified.time"},{name:"Năm sản xuất",value:"year"},{name:"Tên phim",value:"_id"}],we=[{name:"Bách Hợp",slug:"bach-hop"},{name:"Đam Mỹ",slug:"dam-my"}],Se=()=>Array.from({length:25},(f,v)=>{const x=new Date().getFullYear()-v;return{name:x.toString(),slug:x.toString()}}),Ie=()=>{const[f,v]=J(),[x,b]=n.useState([]),[k,C]=n.useState(!0),[E,A]=n.useState(null),[I,P]=n.useState(1),[B,G]=n.useState(!1),[F,O]=n.useState(!0),[u,L]=n.useState({type:!0,genre:!1,country:!1,year:!1}),[q,z]=n.useState([]),[T,R]=n.useState([]),[Y,D]=n.useState(Se()),[$,H]=n.useState(!1),p=f.get("type")||"",c=f.get("genre")||"",m=f.get("country")||"",l=f.get("year")||"",g=f.get("sort")||"modified.time";n.useEffect(()=>{L(e=>({...e,type:!0,genre:e.genre||!!c,country:e.country||!!m,year:e.year||!!l}))},[c,m,l]),n.useEffect(()=>{(async()=>{try{const[a,i,j]=await Promise.allSettled([d.getCategories(),d.getCountries(),d.getYears()]);if(a.status==="fulfilled"){let r=a.value?.data?.items||a.value?.items||[];we.forEach(_=>{r.find(y=>y.slug===_.slug)||(r=[...r,_])}),z(r)}if(i.status==="fulfilled"){const r=i.value?.data?.items||i.value?.items||[];R(r)}if(j.status==="fulfilled"){const r=j.value;let _=r?.data?.items||r?.items||r?.data||[];if(Array.isArray(_)&&_.length>0){const y=_.map(o=>typeof o=="number"||typeof o=="string"?{name:o.toString(),slug:o.toString()}:{name:(o.year||o.name||o.slug||"").toString(),slug:(o.year||o.slug||o.name||"").toString()}).filter(o=>o.name&&o.name!=="undefined");y.length>0&&D(y)}}}catch(a){console.error("Error loading filters:",a)}finally{H(!0)}})()},[]),n.useEffect(()=>{b([]),P(1),M(1)},[p,c,m,l,g]);const M=async e=>{C(!0),A(null);try{let a;if(c?a=await d.getMoviesByCategory(c,e,g):m?a=await d.getMoviesByCountry(m,e,g):l?a=await d.getMoviesByYear(l,e,g):a=await d.getMovies(e,{type:p},g),a?.data?.items){let i=a.data.items;l&&(c||m)&&(i=i.filter(r=>r.year&&r.year.toString()===l)),b(e===1?i:r=>[...r,...i]);const j=a.data.params?.pagination;j&&G(j.currentPage<j.totalPages)}}catch{A("Lỗi tải danh sách phim")}finally{C(!1)}},W=()=>{const e=I+1;P(e),M(e)},h=(e,a)=>{const i=new URLSearchParams(f);a?i.set(e,a):i.delete(e),v(i)},X=()=>{v({})},N=e=>{L(a=>({...a,[e]:!a[e]}))},Q=p||c||m||l,U=()=>{const e=[];if(c){const a=q.find(i=>i.slug===c);e.push(a?a.name:"Thể loại")}if(m){const a=T.find(i=>i.slug===m);e.push(a?a.name:"Quốc gia")}return l&&e.push(`Năm ${l}`),p==="single"&&e.push("Phim lẻ"),p==="series"&&e.push("Phim bộ"),e.length>0?e.join(" • "):"Danh mục phim"};return t.jsxs(t.Fragment,{children:[t.jsx(ee,{}),t.jsx("main",{className:s.browse,children:t.jsxs("div",{className:s.container,children:[t.jsxs("div",{className:s.header,children:[t.jsx("h1",{className:s.title,children:U()}),t.jsxs("div",{className:s.headerActions,children:[t.jsxs("div",{className:s.sortWrapper,children:[t.jsx(K,{className:s.sortIcon}),t.jsx("select",{className:s.sortSelect,value:g,onChange:e=>h("sort",e.target.value),children:ye.map(e=>t.jsx("option",{value:e.value,children:e.name},e.value))})]}),t.jsxs("button",{className:s.filterToggle,onClick:()=>O(!F),children:[t.jsx(V,{})," Bộ lọc"]})]})]}),F&&t.jsxs("div",{className:s.filtersPanel,children:[t.jsxs("div",{className:s.filterGroup,children:[t.jsxs("button",{className:s.filterLabel,onClick:()=>N("type"),children:["Loại phim",u.type?t.jsx(w,{size:14}):t.jsx(S,{size:14})]}),u.type&&t.jsx("div",{className:s.filterOptions,children:Ne.map(e=>t.jsx("button",{className:`${s.filterChip} ${p===e.value?s.chipActive:""}`,onClick:()=>h("type",e.value),children:e.name},e.value))})]}),t.jsxs("div",{className:s.filterGroup,children:[t.jsxs("button",{className:s.filterLabel,onClick:()=>N("genre"),children:["Thể loại ",c&&t.jsx("span",{className:s.activeIndicator,children:"•"}),u.genre?t.jsx(w,{size:14}):t.jsx(S,{size:14})]}),u.genre&&t.jsxs("div",{className:s.filterOptions,children:[t.jsx("button",{className:`${s.filterChip} ${c?"":s.chipActive}`,onClick:()=>h("genre",""),children:"Tất cả"}),q.map(e=>t.jsx("button",{className:`${s.filterChip} ${c===e.slug?s.chipActive:""}`,onClick:()=>h("genre",e.slug),children:e.name},e.slug)),!$&&t.jsx("span",{className:s.filterLoading,children:"Đang tải..."})]})]}),t.jsxs("div",{className:s.filterGroup,children:[t.jsxs("button",{className:s.filterLabel,onClick:()=>N("country"),children:["Quốc gia ",m&&t.jsx("span",{className:s.activeIndicator,children:"•"}),u.country?t.jsx(w,{size:14}):t.jsx(S,{size:14})]}),u.country&&t.jsxs("div",{className:s.filterOptions,children:[t.jsx("button",{className:`${s.filterChip} ${m?"":s.chipActive}`,onClick:()=>h("country",""),children:"Tất cả"}),T.map(e=>t.jsx("button",{className:`${s.filterChip} ${m===e.slug?s.chipActive:""}`,onClick:()=>h("country",e.slug),children:e.name},e.slug)),!$&&t.jsx("span",{className:s.filterLoading,children:"Đang tải..."})]})]}),t.jsxs("div",{className:s.filterGroup,children:[t.jsxs("button",{className:s.filterLabel,onClick:()=>N("year"),children:["Năm ",l&&t.jsx("span",{className:s.activeIndicator,children:"•"}),u.year?t.jsx(w,{size:14}):t.jsx(S,{size:14})]}),u.year&&t.jsxs("div",{className:s.filterOptions,children:[t.jsx("button",{className:`${s.filterChip} ${l?"":s.chipActive}`,onClick:()=>h("year",""),children:"Tất cả"}),Y.map(e=>t.jsx("button",{className:`${s.filterChip} ${l===(e.slug||e.name)?s.chipActive:""}`,onClick:()=>h("year",e.slug||e.name),children:e.name},e.slug||e.name))]})]}),Q&&t.jsxs("button",{className:s.clearBtn,onClick:X,children:[t.jsx(Z,{})," Xóa bộ lọc"]})]}),t.jsx(se,{movies:x,loading:k,error:E,hasMore:B,onLoadMore:W})]})}),t.jsx(te,{})]})};export{Ie as default};
