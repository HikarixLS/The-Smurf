import{j as e}from"./index-CgVwppYc.js";import{u as C,b as a}from"./vendor-DbVhFtnB.js";import{H as S,n as j,r as T,F as P,s as F,t as M,u as I}from"./Header-BXtNmw57.js";import{F as G}from"./Footer-Cmz1iNZx.js";import{w as c,i as R}from"./watchPartyService-CElwi237.js";import"./firebase-DrWFLH48.js";const $="_watchParty_1eg1q_1",k="_container_1eg1q_13",A="_header_1eg1q_25",O="_title_1eg1q_41",E="_subtitle_1eg1q_61",z="_identity_1eg1q_73",H="_createBtn_1eg1q_93",V="_warning_1eg1q_151",X="_createPanel_1eg1q_213",D="_slideIn_1eg1q_1",L="_formGroup_1eg1q_267",U="_input_1eg1q_289",J="_formActions_1eg1q_331",K="_submitBtn_1eg1q_343",W="_cancelBtn_1eg1q_377",Q="_loadingState_1eg1q_407",Y="_emptyState_1eg1q_409",Z="_spinner_1eg1q_447",ee="_spin_1eg1q_447",se="_roomsGrid_1eg1q_481",te="_roomCard_1eg1q_493",ne="_roomThumbnail_1eg1q_523",ae="_roomOverlay_1eg1q_557",ie="_joinBtn_1eg1q_587",oe="_statusBadge_1eg1q_615",re="_playing_1eg1q_637",ce="_waiting_1eg1q_647",le="_paused_1eg1q_657",me="_roomInfo_1eg1q_667",he="_roomTitle_1eg1q_675",de="_roomMeta_1eg1q_695",ge="_host_1eg1q_707",_e="_roomRight_1eg1q_717",ue="_viewers_1eg1q_729",pe="_deleteBtn_1eg1q_745",s={watchParty:$,container:k,header:A,title:O,subtitle:E,identity:z,createBtn:H,warning:V,createPanel:X,slideIn:D,formGroup:L,input:U,formActions:J,submitBtn:K,cancelBtn:W,loadingState:Q,emptyState:Y,spinner:Z,spin:ee,roomsGrid:se,roomCard:te,roomThumbnail:ne,roomOverlay:ae,joinBtn:ie,statusBadge:oe,playing:re,waiting:ce,paused:le,roomInfo:me,roomTitle:he,roomMeta:de,host:ge,roomRight:_e,viewers:ue,deleteBtn:pe},be=()=>{const m=C(),[h,v]=a.useState([]),[f,d]=a.useState(!0),[g,_]=a.useState(!1),[i,y]=a.useState(""),[r,N]=a.useState(""),[u,p]=a.useState(!1),x=c.getSession(),o=R();a.useEffect(()=>{if(!o){d(!1);return}const t=c.onRoomsUpdate(n=>{v(n),d(!1)});return()=>t()},[o]);const b=async()=>{if(!(!i.trim()||!r.trim())){p(!0);try{const t=await c.createRoom({movieSlug:i.trim(),movieName:r.trim(),movieThumb:`https://img.ophim.live/uploads/movies/${i.trim()}-thumb.jpg`});m(`/watch-party/room/${t.id}`)}catch(t){console.error("Create room error:",t),alert("Kh√¥ng th·ªÉ t·∫°o ph√≤ng: "+t.message)}finally{p(!1)}}},q=t=>{m(`/watch-party/room/${t}`)},B=async(t,n)=>{n.stopPropagation(),confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ph√≤ng n√†y?")&&await c.deleteRoom(t)},w=t=>{const n=Math.floor((Date.now()-t)/6e4);if(n<1)return"V·ª´a xong";if(n<60)return`${n} ph√∫t tr∆∞·ªõc`;const l=Math.floor(n/60);return l<24?`${l} gi·ªù tr∆∞·ªõc`:`${Math.floor(l/24)} ng√†y tr∆∞·ªõc`};return e.jsxs(e.Fragment,{children:[e.jsx(S,{}),e.jsx("main",{className:s.watchParty,children:e.jsxs("div",{className:s.container,children:[e.jsxs("div",{className:s.header,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:s.title,children:[e.jsx(j,{})," Xem Chung"]}),e.jsx("p",{className:s.subtitle,children:"T·∫°o ph√≤ng ho·∫∑c tham gia ph√≤ng xem phim c√πng b·∫°n b√®"}),e.jsxs("p",{className:s.identity,children:["B·∫°n l√†: ",e.jsx("strong",{children:x.name})]})]}),e.jsxs("button",{className:s.createBtn,onClick:()=>_(!g),disabled:!o,children:[e.jsx(T,{})," T·∫°o ph√≤ng"]})]}),!o&&e.jsxs("div",{className:s.warning,children:[e.jsx(I,{size:24}),e.jsxs("div",{children:[e.jsx("strong",{children:"Firebase ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh"}),e.jsxs("p",{children:["Vui l√≤ng th√™m Firebase credentials v√†o file ",e.jsx("code",{children:".env"})," ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng Xem Chung. Xem h∆∞·ªõng d·∫´n trong file ",e.jsx("code",{children:".env.example"}),"."]})]})]}),g&&o&&e.jsxs("div",{className:s.createPanel,children:[e.jsx("h3",{children:"T·∫°o ph√≤ng xem chung"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Slug phim (VD: dam-lay-muoi)"}),e.jsx("input",{type:"text",value:i,onChange:t=>y(t.target.value),placeholder:"dam-lay-muoi",className:s.input})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"T√™n phim"}),e.jsx("input",{type:"text",value:r,onChange:t=>N(t.target.value),placeholder:"ƒê·∫ßm L·∫ßy Mu·ªëi",className:s.input})]}),e.jsxs("div",{className:s.formActions,children:[e.jsx("button",{className:s.submitBtn,onClick:b,disabled:u||!i.trim()||!r.trim(),children:u?"ƒêang t·∫°o...":"T·∫°o ph√≤ng"}),e.jsx("button",{className:s.cancelBtn,onClick:()=>_(!1),children:"H·ªßy"})]})]}),f?e.jsxs("div",{className:s.loadingState,children:[e.jsx("div",{className:s.spinner}),e.jsx("p",{children:"ƒêang t·∫£i danh s√°ch ph√≤ng..."})]}):h.length===0?e.jsxs("div",{className:s.emptyState,children:[e.jsx(j,{size:48}),e.jsx("h2",{children:"Ch∆∞a c√≥ ph√≤ng n√†o"}),e.jsx("p",{children:"H√£y t·∫°o ph√≤ng ƒë·∫ßu ti√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu xem phim c√πng b·∫°n b√®!"})]}):e.jsx("div",{className:s.roomsGrid,children:h.map(t=>e.jsxs("div",{className:s.roomCard,onClick:()=>q(t.id),children:[e.jsxs("div",{className:s.roomThumbnail,children:[e.jsx("img",{src:t.movieThumb,alt:t.movieName,onError:n=>{n.target.src="https://via.placeholder.com/400x225/1a1a1a/666?text=No+Image"}}),e.jsx("div",{className:s.roomOverlay,children:e.jsxs("button",{className:s.joinBtn,children:[e.jsx(P,{})," Tham gia"]})}),e.jsx("span",{className:`${s.statusBadge} ${s[t.status]}`,children:t.status==="playing"?"üî¥ LIVE":t.status==="paused"?"‚è∏ Paused":"‚è≥ Ch·ªù"})]}),e.jsxs("div",{className:s.roomInfo,children:[e.jsx("h3",{className:s.roomTitle,children:t.movieName}),e.jsxs("div",{className:s.roomMeta,children:[e.jsxs("span",{className:s.host,children:[t.hostName," ‚Ä¢ ",w(t.createdAt)]}),e.jsxs("div",{className:s.roomRight,children:[e.jsxs("span",{className:s.viewers,children:[e.jsx(F,{size:12})," ",t.members?Object.keys(t.members).length:0]}),t.hostId===x.id&&e.jsx("button",{className:s.deleteBtn,onClick:n=>B(t.id,n),title:"X√≥a ph√≤ng",children:e.jsx(M,{size:14})})]})]})]})]},t.id))})]})}),e.jsx(G,{})]})};export{be as default};
