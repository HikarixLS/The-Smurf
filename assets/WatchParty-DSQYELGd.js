import{i as G,j as e}from"./index-CKIGZ-Zr.js";import{e as $,b as r}from"./vendor-DTekaQTv.js";import{B,D as E,E as O,d as A,e as w,F as H,G as X,H as z}from"./index-CWt2mSl_.js";import{H as D}from"./Header-CVFfGWSw.js";import{g as x,F as L}from"./helpers-BCy9yaU_.js";import{w as m}from"./watchPartyService-D8JSnK3U.js";import{m as U}from"./movieService-BgO2l0O7.js";import"./firebase-B8FQZRyY.js";import"./endpoints-DUQzCDa2.js";const Q="_watchParty_1eg1q_1",V="_container_1eg1q_13",K="_header_1eg1q_25",W="_title_1eg1q_41",J="_subtitle_1eg1q_61",Y="_identity_1eg1q_73",Z="_createBtn_1eg1q_93",ee="_warning_1eg1q_151",se="_createPanel_1eg1q_213",te="_slideIn_1eg1q_1",ae="_formGroup_1eg1q_267",ne="_input_1eg1q_289",re="_formActions_1eg1q_331",ie="_submitBtn_1eg1q_343",ce="_cancelBtn_1eg1q_377",oe="_loadingState_1eg1q_407",le="_emptyState_1eg1q_409",me="_spinner_1eg1q_447",he="_spin_1eg1q_447",de="_roomsGrid_1eg1q_481",ge="_roomCard_1eg1q_493",ue="_roomThumbnail_1eg1q_523",_e="_roomOverlay_1eg1q_557",pe="_joinBtn_1eg1q_587",xe="_statusBadge_1eg1q_615",je="_playing_1eg1q_637",ye="_waiting_1eg1q_647",Ne="_paused_1eg1q_657",fe="_roomInfo_1eg1q_667",ve="_roomTitle_1eg1q_675",be="_roomMeta_1eg1q_695",qe="_host_1eg1q_707",Se="_roomRight_1eg1q_717",Be="_viewers_1eg1q_729",we="_deleteBtn_1eg1q_745",t={watchParty:Q,container:V,header:K,title:W,subtitle:J,identity:Y,createBtn:Z,warning:ee,createPanel:se,slideIn:te,formGroup:ae,input:ne,formActions:re,submitBtn:ie,cancelBtn:ce,loadingState:oe,emptyState:le,spinner:me,spin:he,roomsGrid:de,roomCard:ge,roomThumbnail:ue,roomOverlay:_e,joinBtn:pe,statusBadge:xe,playing:je,waiting:ye,paused:Ne,roomInfo:fe,roomTitle:ve,roomMeta:be,host:qe,roomRight:Se,viewers:Be,deleteBtn:we},$e=()=>{const j=$(),[y,C]=r.useState([]),[T,N]=r.useState(!0),[f,v]=r.useState(!1),[b,q]=r.useState(!1),S=m.getSession(),c=G(),[h,o]=r.useState(""),[d,i]=r.useState([]),[g,u]=r.useState(!1),[a,l]=r.useState(null),_=r.useRef(null);r.useEffect(()=>{if(!c){N(!1);return}const s=m.onRoomsUpdate(n=>{C(n),N(!1)});return()=>s()},[c]);const I=r.useCallback(s=>{if(o(s),l(null),_.current&&clearTimeout(_.current),!s.trim()||s.trim().length<2){i([]),u(!1);return}u(!0),_.current=setTimeout(async()=>{try{const n=await U.searchMovies(s.trim(),1,10);n?.data?.items?i(n.data.items):i([])}catch(n){console.error("Search error:",n),i([])}finally{u(!1)}},400)},[]),F=s=>{l(s),o(""),i([])},M=async()=>{if(a){q(!0);try{const s=x(a.thumb_url||a.poster_url),n=await m.createRoom({movieSlug:a.slug,movieName:a.name,movieThumb:s,movieOriginName:a.origin_name||"",movieYear:a.year||"",movieQuality:a.quality||""});j(`/watch-party/room/${n.id}`)}catch(s){console.error("Create room error:",s),alert("Kh√¥ng th·ªÉ t·∫°o ph√≤ng: "+s.message)}finally{q(!1)}}},P=s=>{j(`/watch-party/room/${s}`)},k=async(s,n)=>{n.stopPropagation(),confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ph√≤ng n√†y?")&&await m.deleteRoom(s)},R=s=>{const n=Math.floor((Date.now()-s)/6e4);if(n<1)return"V·ª´a xong";if(n<60)return`${n} ph√∫t tr∆∞·ªõc`;const p=Math.floor(n/60);return p<24?`${p} gi·ªù tr∆∞·ªõc`:`${Math.floor(p/24)} ng√†y tr∆∞·ªõc`};return e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsx("main",{className:t.watchParty,children:e.jsxs("div",{className:t.container,children:[e.jsxs("div",{className:t.header,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:t.title,children:[e.jsx(B,{})," Xem Chung"]}),e.jsx("p",{className:t.subtitle,children:"T·∫°o ph√≤ng ho·∫∑c tham gia ph√≤ng xem phim c√πng b·∫°n b√®"}),e.jsxs("p",{className:t.identity,children:["B·∫°n l√†: ",e.jsx("strong",{children:S.name})]})]}),e.jsxs("button",{className:t.createBtn,onClick:()=>{v(!f),l(null),o(""),i([])},disabled:!c,children:[e.jsx(E,{})," T·∫°o ph√≤ng"]})]}),!c&&e.jsxs("div",{className:t.warning,children:[e.jsx(O,{size:24}),e.jsxs("div",{children:[e.jsx("strong",{children:"Firebase ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh"}),e.jsxs("p",{children:["Vui l√≤ng th√™m Firebase credentials v√†o file ",e.jsx("code",{children:".env"})," ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng Xem Chung. Xem h∆∞·ªõng d·∫´n trong file ",e.jsx("code",{children:".env.example"}),"."]})]})]}),f&&c&&e.jsxs("div",{className:t.createPanel,children:[e.jsx("h3",{children:"T·∫°o ph√≤ng xem chung"}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"T√¨m phim ƒë·ªÉ xem chung"}),e.jsxs("div",{className:t.searchWrapper,children:[e.jsx(A,{className:t.searchIcon}),e.jsx("input",{type:"text",value:h,onChange:s=>I(s.target.value),placeholder:"Nh·∫≠p t√™n phim ƒë·ªÉ t√¨m ki·∫øm...",className:t.input,autoFocus:!0}),h&&e.jsx("button",{className:t.clearSearch,onClick:()=>{o(""),i([])},children:e.jsx(w,{})})]}),(d.length>0||g)&&e.jsxs("div",{className:t.searchDropdown,children:[g?e.jsxs("div",{className:t.searchLoading,children:[e.jsx("div",{className:t.miniSpinner}),"ƒêang t√¨m ki·∫øm..."]}):d.map(s=>e.jsxs("div",{className:t.searchItem,onClick:()=>F(s),children:[e.jsx("img",{src:x(s.thumb_url||s.poster_url),alt:s.name,className:t.searchThumb,onError:n=>{n.target.style.display="none"}}),e.jsxs("div",{className:t.searchItemInfo,children:[e.jsx("span",{className:t.searchItemName,children:s.name}),e.jsxs("span",{className:t.searchItemMeta,children:[s.origin_name&&e.jsx("em",{children:s.origin_name}),s.year&&` ‚Ä¢ ${s.year}`,s.quality&&` ‚Ä¢ ${s.quality}`]})]})]},s.slug)),!g&&d.length===0&&h.length>=2&&e.jsx("div",{className:t.searchLoading,children:"Kh√¥ng t√¨m th·∫•y phim"})]})]}),a&&e.jsxs("div",{className:t.selectedMovie,children:[e.jsx("img",{src:x(a.thumb_url||a.poster_url),alt:a.name,className:t.selectedThumb,onError:s=>{s.target.style.display="none"}}),e.jsxs("div",{className:t.selectedInfo,children:[e.jsx("h4",{children:a.name}),a.origin_name&&e.jsx("p",{className:t.selectedOrigin,children:a.origin_name}),e.jsxs("div",{className:t.selectedMeta,children:[a.year&&e.jsx("span",{children:a.year}),a.quality&&e.jsx("span",{className:t.qualityTag,children:a.quality}),a.lang&&e.jsx("span",{className:t.langTag,children:a.lang}),a.episode_current&&e.jsx("span",{children:a.episode_current})]})]}),e.jsx("button",{className:t.removeSelected,onClick:()=>l(null),children:e.jsx(w,{})})]}),e.jsxs("div",{className:t.formActions,children:[e.jsx("button",{className:t.submitBtn,onClick:M,disabled:b||!a,children:b?"ƒêang t·∫°o...":"üé¨ T·∫°o ph√≤ng xem chung"}),e.jsx("button",{className:t.cancelBtn,onClick:()=>v(!1),children:"H·ªßy"})]})]}),T?e.jsxs("div",{className:t.loadingState,children:[e.jsx("div",{className:t.spinner}),e.jsx("p",{children:"ƒêang t·∫£i danh s√°ch ph√≤ng..."})]}):y.length===0?e.jsxs("div",{className:t.emptyState,children:[e.jsx(B,{size:48}),e.jsx("h2",{children:"Ch∆∞a c√≥ ph√≤ng n√†o"}),e.jsx("p",{children:"H√£y t·∫°o ph√≤ng ƒë·∫ßu ti√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu xem phim c√πng b·∫°n b√®!"})]}):e.jsx("div",{className:t.roomsGrid,children:y.map(s=>e.jsxs("div",{className:t.roomCard,onClick:()=>P(s.id),children:[e.jsxs("div",{className:t.roomThumbnail,children:[e.jsx("img",{src:s.movieThumb,alt:s.movieName,onError:n=>{n.target.style.display="none"}}),e.jsx("div",{className:t.roomOverlay,children:e.jsxs("button",{className:t.joinBtn,children:[e.jsx(H,{})," Tham gia"]})}),e.jsx("span",{className:`${t.statusBadge} ${t[s.status]}`,children:s.status==="playing"?"üî¥ LIVE":s.status==="paused"?"‚è∏ Paused":"‚è≥ Ch·ªù"})]}),e.jsxs("div",{className:t.roomInfo,children:[e.jsx("h3",{className:t.roomTitle,children:s.movieName}),e.jsxs("div",{className:t.roomMeta,children:[e.jsxs("span",{className:t.host,children:[s.hostName," ‚Ä¢ ",R(s.createdAt)]}),e.jsxs("div",{className:t.roomRight,children:[e.jsxs("span",{className:t.viewers,children:[e.jsx(X,{size:12})," ",s.members?Object.keys(s.members).length:0]}),s.hostId===S.id&&e.jsx("button",{className:t.deleteBtn,onClick:n=>k(s.id,n),title:"X√≥a ph√≤ng",children:e.jsx(z,{size:14})})]})]})]})]},s.id))})]})}),e.jsx(L,{})]})};export{$e as default};
