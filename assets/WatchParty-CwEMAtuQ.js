import{i as q,j as e}from"./index-KmnY2XZD.js";import{e as G,b as r}from"./vendor-DTekaQTv.js";import{B as T,D as $,E,d as D,e as w,F as L,G as A,H}from"./index-D5LGCugf.js";import{H as W}from"./Header-CNB_sl3P.js";import{g as x,F as X}from"./helpers-ATXETRmg.js";import{w as m}from"./watchPartyService-CTa6eB4M.js";import{m as z}from"./movieService-Cen5a6tX.js";import"./firebase-B8FQZRyY.js";import"./endpoints-CE5CwJAc.js";const U="_watchParty_e6am7_1",Q="_container_e6am7_13",V="_header_e6am7_25",K="_title_e6am7_41",J="_subtitle_e6am7_61",Y="_identity_e6am7_73",Z="_createBtn_e6am7_93",ee="_warning_e6am7_151",se="_createPanel_e6am7_213",ae="_slideIn_e6am7_1",te="_formGroup_e6am7_267",ne="_input_e6am7_289",re="_formActions_e6am7_331",ce="_submitBtn_e6am7_343",ie="_cancelBtn_e6am7_377",oe="_loadingState_e6am7_407",le="_emptyState_e6am7_409",me="_spinner_e6am7_447",he="_spin_e6am7_447",de="_roomsGrid_e6am7_481",_e="_roomCard_e6am7_493",ue="_roomThumbnail_e6am7_523",ge="_roomOverlay_e6am7_557",pe="_joinBtn_e6am7_587",xe="_statusBadge_e6am7_615",je="_playing_e6am7_637",ye="_waiting_e6am7_647",Ne="_paused_e6am7_657",fe="_roomInfo_e6am7_667",ve="_roomTitle_e6am7_675",be="_roomMeta_e6am7_695",Se="_host_e6am7_707",Ie="_roomRight_e6am7_717",Te="_viewers_e6am7_729",we="_deleteBtn_e6am7_745",Be="_searchWrapper_e6am7_805",Ce="_searchIcon_e6am7_817",Me="_clearSearch_e6am7_839",Fe="_searchDropdown_e6am7_871",Pe="_searchItem_e6am7_889",ke="_searchThumb_e6am7_925",Re="_searchItemInfo_e6am7_943",Oe="_searchItemName_e6am7_959",qe="_searchItemMeta_e6am7_977",Ge="_searchLoading_e6am7_1003",$e="_miniSpinner_e6am7_1023",Ee="_selectedMovie_e6am7_1043",De="_selectedThumb_e6am7_1067",Le="_selectedInfo_e6am7_1083",Ae="_selectedOrigin_e6am7_1095",He="_selectedMeta_e6am7_1109",We="_qualityTag_e6am7_1131",Xe="_langTag_e6am7_1133",ze="_removeSelected_e6am7_1145",a={watchParty:U,container:Q,header:V,title:K,subtitle:J,identity:Y,createBtn:Z,warning:ee,createPanel:se,slideIn:ae,formGroup:te,input:ne,formActions:re,submitBtn:ce,cancelBtn:ie,loadingState:oe,emptyState:le,spinner:me,spin:he,roomsGrid:de,roomCard:_e,roomThumbnail:ue,roomOverlay:ge,joinBtn:pe,statusBadge:xe,playing:je,waiting:ye,paused:Ne,roomInfo:fe,roomTitle:ve,roomMeta:be,host:Se,roomRight:Ie,viewers:Te,deleteBtn:we,searchWrapper:Be,searchIcon:Ce,clearSearch:Me,searchDropdown:Fe,searchItem:Pe,searchThumb:ke,searchItemInfo:Re,searchItemName:Oe,searchItemMeta:qe,searchLoading:Ge,miniSpinner:$e,selectedMovie:Ee,selectedThumb:De,selectedInfo:Le,selectedOrigin:Ae,selectedMeta:He,qualityTag:We,langTag:Xe,removeSelected:ze},as=()=>{const j=G(),[y,B]=r.useState([]),[C,N]=r.useState(!0),[f,v]=r.useState(!1),[b,S]=r.useState(!1),I=m.getSession(),i=q(),[h,o]=r.useState(""),[d,c]=r.useState([]),[_,u]=r.useState(!1),[t,l]=r.useState(null),g=r.useRef(null);r.useEffect(()=>{if(!i){N(!1);return}const s=m.onRoomsUpdate(n=>{B(n),N(!1)});return()=>s()},[i]);const M=r.useCallback(s=>{if(o(s),l(null),g.current&&clearTimeout(g.current),!s.trim()||s.trim().length<2){c([]),u(!1);return}u(!0),g.current=setTimeout(async()=>{try{const n=await z.searchMovies(s.trim(),1,10);n?.data?.items?c(n.data.items):c([])}catch(n){console.error("Search error:",n),c([])}finally{u(!1)}},400)},[]),F=s=>{l(s),o(""),c([])},P=async()=>{if(t){S(!0);try{const s=x(t.thumb_url||t.poster_url),n=await m.createRoom({movieSlug:t.slug,movieName:t.name,movieThumb:s,movieOriginName:t.origin_name||"",movieYear:t.year||"",movieQuality:t.quality||""});j(`/watch-party/room/${n.id}`)}catch(s){console.error("Create room error:",s),alert("Kh√¥ng th·ªÉ t·∫°o ph√≤ng: "+s.message)}finally{S(!1)}}},k=s=>{j(`/watch-party/room/${s}`)},R=async(s,n)=>{n.stopPropagation(),confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ph√≤ng n√†y?")&&await m.deleteRoom(s)},O=s=>{const n=Math.floor((Date.now()-s)/6e4);if(n<1)return"V·ª´a xong";if(n<60)return`${n} ph√∫t tr∆∞·ªõc`;const p=Math.floor(n/60);return p<24?`${p} gi·ªù tr∆∞·ªõc`:`${Math.floor(p/24)} ng√†y tr∆∞·ªõc`};return e.jsxs(e.Fragment,{children:[e.jsx(W,{}),e.jsx("main",{className:a.watchParty,children:e.jsxs("div",{className:a.container,children:[e.jsxs("div",{className:a.header,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:a.title,children:[e.jsx(T,{})," Xem Chung"]}),e.jsx("p",{className:a.subtitle,children:"T·∫°o ph√≤ng ho·∫∑c tham gia ph√≤ng xem phim c√πng b·∫°n b√®"}),e.jsxs("p",{className:a.identity,children:["B·∫°n l√†: ",e.jsx("strong",{children:I.name})]})]}),e.jsxs("button",{className:a.createBtn,onClick:()=>{v(!f),l(null),o(""),c([])},disabled:!i,children:[e.jsx($,{})," T·∫°o ph√≤ng"]})]}),!i&&e.jsxs("div",{className:a.warning,children:[e.jsx(E,{size:24}),e.jsxs("div",{children:[e.jsx("strong",{children:"Firebase ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh"}),e.jsxs("p",{children:["Vui l√≤ng th√™m Firebase credentials v√†o file ",e.jsx("code",{children:".env"})," ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng Xem Chung. Xem h∆∞·ªõng d·∫´n trong file ",e.jsx("code",{children:".env.example"}),"."]})]})]}),f&&i&&e.jsxs("div",{className:a.createPanel,children:[e.jsx("h3",{children:"T·∫°o ph√≤ng xem chung"}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"T√¨m phim ƒë·ªÉ xem chung"}),e.jsxs("div",{className:a.searchWrapper,children:[e.jsx(D,{className:a.searchIcon}),e.jsx("input",{type:"text",value:h,onChange:s=>M(s.target.value),placeholder:"Nh·∫≠p t√™n phim ƒë·ªÉ t√¨m ki·∫øm...",className:a.input,autoFocus:!0}),h&&e.jsx("button",{className:a.clearSearch,onClick:()=>{o(""),c([])},children:e.jsx(w,{})})]}),(d.length>0||_)&&e.jsxs("div",{className:a.searchDropdown,children:[_?e.jsxs("div",{className:a.searchLoading,children:[e.jsx("div",{className:a.miniSpinner}),"ƒêang t√¨m ki·∫øm..."]}):d.map(s=>e.jsxs("div",{className:a.searchItem,onClick:()=>F(s),children:[e.jsx("img",{src:x(s.thumb_url||s.poster_url),alt:s.name,className:a.searchThumb,onError:n=>{n.target.style.display="none"}}),e.jsxs("div",{className:a.searchItemInfo,children:[e.jsx("span",{className:a.searchItemName,children:s.name}),e.jsxs("span",{className:a.searchItemMeta,children:[s.origin_name&&e.jsx("em",{children:s.origin_name}),s.year&&` ‚Ä¢ ${s.year}`,s.quality&&` ‚Ä¢ ${s.quality}`]})]})]},s.slug)),!_&&d.length===0&&h.length>=2&&e.jsx("div",{className:a.searchLoading,children:"Kh√¥ng t√¨m th·∫•y phim"})]})]}),t&&e.jsxs("div",{className:a.selectedMovie,children:[e.jsx("img",{src:x(t.thumb_url||t.poster_url),alt:t.name,className:a.selectedThumb,onError:s=>{s.target.style.display="none"}}),e.jsxs("div",{className:a.selectedInfo,children:[e.jsx("h4",{children:t.name}),t.origin_name&&e.jsx("p",{className:a.selectedOrigin,children:t.origin_name}),e.jsxs("div",{className:a.selectedMeta,children:[t.year&&e.jsx("span",{children:t.year}),t.quality&&e.jsx("span",{className:a.qualityTag,children:t.quality}),t.lang&&e.jsx("span",{className:a.langTag,children:t.lang}),t.episode_current&&e.jsx("span",{children:t.episode_current})]})]}),e.jsx("button",{className:a.removeSelected,onClick:()=>l(null),children:e.jsx(w,{})})]}),e.jsxs("div",{className:a.formActions,children:[e.jsx("button",{className:a.submitBtn,onClick:P,disabled:b||!t,children:b?"ƒêang t·∫°o...":"üé¨ T·∫°o ph√≤ng xem chung"}),e.jsx("button",{className:a.cancelBtn,onClick:()=>v(!1),children:"H·ªßy"})]})]}),C?e.jsxs("div",{className:a.loadingState,children:[e.jsx("div",{className:a.spinner}),e.jsx("p",{children:"ƒêang t·∫£i danh s√°ch ph√≤ng..."})]}):y.length===0?e.jsxs("div",{className:a.emptyState,children:[e.jsx(T,{size:48}),e.jsx("h2",{children:"Ch∆∞a c√≥ ph√≤ng n√†o"}),e.jsx("p",{children:"H√£y t·∫°o ph√≤ng ƒë·∫ßu ti√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu xem phim c√πng b·∫°n b√®!"})]}):e.jsx("div",{className:a.roomsGrid,children:y.map(s=>e.jsxs("div",{className:a.roomCard,onClick:()=>k(s.id),children:[e.jsxs("div",{className:a.roomThumbnail,children:[e.jsx("img",{src:s.movieThumb,alt:s.movieName,onError:n=>{n.target.style.display="none"}}),e.jsx("div",{className:a.roomOverlay,children:e.jsxs("button",{className:a.joinBtn,children:[e.jsx(L,{})," Tham gia"]})}),e.jsx("span",{className:`${a.statusBadge} ${a[s.status]}`,children:s.status==="playing"?"üî¥ LIVE":s.status==="paused"?"‚è∏ Paused":"‚è≥ Ch·ªù"})]}),e.jsxs("div",{className:a.roomInfo,children:[e.jsx("h3",{className:a.roomTitle,children:s.movieName}),e.jsxs("div",{className:a.roomMeta,children:[e.jsxs("span",{className:a.host,children:[s.hostName," ‚Ä¢ ",O(s.createdAt)]}),e.jsxs("div",{className:a.roomRight,children:[e.jsxs("span",{className:a.viewers,children:[e.jsx(A,{size:12})," ",s.members?Object.keys(s.members).length:0]}),s.hostId===I.id&&e.jsx("button",{className:a.deleteBtn,onClick:n=>R(s.id,n),title:"X√≥a ph√≤ng",children:e.jsx(H,{size:14})})]})]})]})]},s.id))})]})}),e.jsx(X,{})]})};export{as as default};
