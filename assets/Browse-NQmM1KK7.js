import{j as s}from"./index-BDTOxS1D.js";import{e as Y,b as l}from"./vendor-DbVhFtnB.js";import{H,f as D,g as Q,e as X}from"./Header-CcEJfMqN.js";import{F as U}from"./Footer-De9tRN7s.js";import{M as q}from"./MovieGrid-4a-Ibvpt.js";import{m}from"./movieService-BuZ_f8lD.js";import"./index-CO4GaNJo.js";import"./MovieCard-CbBsXmNZ.js";import"./endpoints-CNvTD5q0.js";const z="_browse_1lk4x_1",J="_container_1lk4x_7",K="_header_1lk4x_13",V="_title_1lk4x_20",Z="_headerActions_1lk4x_27",ee="_sortWrapper_1lk4x_33",se="_sortIcon_1lk4x_39",te="_sortSelect_1lk4x_47",ie="_filterToggle_1lk4x_70",ae="_filterLoading_1lk4x_89",le="_filtersPanel_1lk4x_96",re="_filterGroup_1lk4x_117",ne="_filterLabel_1lk4x_125",ce="_filterOptions_1lk4x_135",oe="_filterChip_1lk4x_141",me="_chipActive_1lk4x_157",de="_clearBtn_1lk4x_164",t={browse:z,container:J,header:K,title:V,headerActions:Z,sortWrapper:ee,sortIcon:se,sortSelect:te,filterToggle:ie,filterLoading:ae,filtersPanel:le,filterGroup:re,filterLabel:ne,filterOptions:ce,filterChip:oe,chipActive:me,clearBtn:de},ue=[{name:"Tất cả",value:""},{name:"Phim lẻ",value:"single"},{name:"Phim bộ",value:"series"}],fe=[{name:"Mới cập nhật",value:"modified.time"},{name:"Năm sản xuất",value:"year"},{name:"Tên phim",value:"_id"}],be=()=>{const[d,v]=Y(),[k,g]=l.useState([]),[L,_]=l.useState(!0),[P,j]=l.useState(null),[A,N]=l.useState(1),[w,F]=l.useState(!1),[C,T]=l.useState(!0),[b,$]=l.useState([]),[y,M]=l.useState([]),[O,B]=l.useState([]),[x,G]=l.useState(!1),u=d.get("type")||"",r=d.get("genre")||"",n=d.get("country")||"",c=d.get("year")||"",f=d.get("sort")||"modified.time";l.useEffect(()=>{(async()=>{try{const[i,a,h]=await Promise.allSettled([m.getCategories(),m.getCountries(),m.getYears()]);if(i.status==="fulfilled"){const p=i.value?.data?.items||i.value?.items||[];$(p)}if(a.status==="fulfilled"){const p=a.value?.data?.items||a.value?.items||[];M(p)}if(h.status==="fulfilled"){const p=h.value?.data?.items||h.value?.items||[];B(p)}}catch(i){console.error("Error loading filters:",i)}finally{G(!0)}})()},[]),l.useEffect(()=>{g([]),N(1),S(1)},[u,r,n,c,f]);const S=async e=>{_(!0),j(null);try{let i;if(r?i=await m.getMoviesByCategory(r,e,f):n?i=await m.getMoviesByCountry(n,e,f):c?i=await m.getMoviesByYear(c,e,f):i=await m.getMovies(e,{type:u},f),i?.data?.items){g(e===1?i.data.items:h=>[...h,...i.data.items]);const a=i.data.params?.pagination;a&&F(a.currentPage<a.totalPages)}}catch{j("Lỗi tải danh sách phim")}finally{_(!1)}},E=()=>{const e=A+1;N(e),S(e)},o=(e,i)=>{const a=new URLSearchParams(d);i?(e==="genre"&&(a.delete("country"),a.delete("year")),e==="country"&&(a.delete("genre"),a.delete("year")),e==="year"&&(a.delete("genre"),a.delete("country")),a.set(e,i)):a.delete(e),v(a)},R=()=>{v({})},I=u||r||n||c,W=()=>{if(r){const e=b.find(i=>i.slug===r);return e?e.name:"Thể loại"}if(n){const e=y.find(i=>i.slug===n);return e?e.name:"Quốc gia"}return c?`Năm ${c}`:u==="single"?"Phim lẻ":u==="series"?"Phim bộ":"Danh mục phim"};return s.jsxs(s.Fragment,{children:[s.jsx(H,{}),s.jsx("main",{className:t.browse,children:s.jsxs("div",{className:t.container,children:[s.jsxs("div",{className:t.header,children:[s.jsx("h1",{className:t.title,children:W()}),s.jsxs("div",{className:t.headerActions,children:[s.jsxs("div",{className:t.sortWrapper,children:[s.jsx(D,{className:t.sortIcon}),s.jsx("select",{className:t.sortSelect,value:f,onChange:e=>o("sort",e.target.value),children:fe.map(e=>s.jsx("option",{value:e.value,children:e.name},e.value))})]}),s.jsxs("button",{className:t.filterToggle,onClick:()=>T(!C),children:[s.jsx(Q,{})," Bộ lọc"]})]})]}),C&&s.jsxs("div",{className:t.filtersPanel,children:[s.jsxs("div",{className:t.filterGroup,children:[s.jsx("span",{className:t.filterLabel,children:"Loại phim"}),s.jsx("div",{className:t.filterOptions,children:ue.map(e=>s.jsx("button",{className:`${t.filterChip} ${u===e.value?t.chipActive:""}`,onClick:()=>o("type",e.value),children:e.name},e.value))})]}),s.jsxs("div",{className:t.filterGroup,children:[s.jsx("span",{className:t.filterLabel,children:"Thể loại"}),s.jsxs("div",{className:t.filterOptions,children:[s.jsx("button",{className:`${t.filterChip} ${r?"":t.chipActive}`,onClick:()=>o("genre",""),children:"Tất cả"}),b.map(e=>s.jsx("button",{className:`${t.filterChip} ${r===e.slug?t.chipActive:""}`,onClick:()=>o("genre",e.slug),children:e.name},e.slug)),!x&&s.jsx("span",{className:t.filterLoading,children:"Đang tải..."})]})]}),s.jsxs("div",{className:t.filterGroup,children:[s.jsx("span",{className:t.filterLabel,children:"Quốc gia"}),s.jsxs("div",{className:t.filterOptions,children:[s.jsx("button",{className:`${t.filterChip} ${n?"":t.chipActive}`,onClick:()=>o("country",""),children:"Tất cả"}),y.map(e=>s.jsx("button",{className:`${t.filterChip} ${n===e.slug?t.chipActive:""}`,onClick:()=>o("country",e.slug),children:e.name},e.slug)),!x&&s.jsx("span",{className:t.filterLoading,children:"Đang tải..."})]})]}),s.jsxs("div",{className:t.filterGroup,children:[s.jsx("span",{className:t.filterLabel,children:"Năm"}),s.jsxs("div",{className:t.filterOptions,children:[s.jsx("button",{className:`${t.filterChip} ${c?"":t.chipActive}`,onClick:()=>o("year",""),children:"Tất cả"}),O.map(e=>s.jsx("button",{className:`${t.filterChip} ${c===(e.slug||e.name)?t.chipActive:""}`,onClick:()=>o("year",e.slug||e.name),children:e.name},e.slug||e.name)),!x&&s.jsx("span",{className:t.filterLoading,children:"Đang tải..."})]})]}),I&&s.jsxs("button",{className:t.clearBtn,onClick:R,children:[s.jsx(X,{})," Xóa bộ lọc"]})]}),s.jsx(q,{movies:k,loading:L,error:P,hasMore:w,onLoadMore:E})]})}),s.jsx(U,{})]})};export{be as default};
